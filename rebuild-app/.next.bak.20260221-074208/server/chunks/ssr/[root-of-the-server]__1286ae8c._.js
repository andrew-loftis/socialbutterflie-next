module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},22168,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(89195);let e={workspaceId:"workspace-primary",userId:"anonymous",role:"viewer",activeCompanyId:null,companyGateSeenInSession:!1};function f(){return e}let g=(0,c.createContext)(null);function h({children:a}){let{user:h}=(0,d.useAuth)(),[i,j]=(0,c.useState)(f),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)({}),[o,p]=(0,c.useState)(null),q=(0,c.useMemo)(()=>({...i,userId:h?.uid||e.userId,role:h?"editor":"viewer"}),[i,h]),r=(0,c.useMemo)(()=>({appContext:q,setAppContext:j,companies:k,setCompanies:l,membersByCompany:m,setMembersByCompany:n,setActiveCompany:a=>{j(b=>({...b,activeCompanyId:a}))},markCompanyGateSeen:a=>{j(b=>({...b,companyGateSeenInSession:a}))},inspector:o,setInspector:p}),[q,k,m,o]);return(0,b.jsx)(g.Provider,{value:r,children:a})}function i(){let a=(0,c.useContext)(g);if(!a)throw Error("useAppState must be used inside AppStateProvider");return a}a.s(["AppStateProvider",()=>h,"useAppState",()=>i])},53653,a=>{"use strict";a.i(84705);var b=a.i(14692);function c(a,c){if(a instanceof b.FirebaseError){var d=a.code;if("auth"===c)switch(d){case"auth/invalid-credential":case"auth/wrong-password":case"auth/user-not-found":return"Invalid email or password.";case"auth/email-already-in-use":return"That email is already registered. Sign in instead.";case"auth/invalid-email":return"Enter a valid email address.";case"auth/weak-password":return"Password must be at least 6 characters.";case"auth/operation-not-allowed":return"Enable this sign-in provider in Firebase Auth -> Sign-in method.";case"auth/account-exists-with-different-credential":return"An account already exists with a different sign-in provider for this email.";case"auth/popup-blocked":return"Popup was blocked by the browser. Allow popups and try again.";case"auth/popup-closed-by-user":return"Sign-in popup was closed before finishing.";case"auth/unauthorized-domain":return"This domain is not authorized in Firebase Auth settings.";case"auth/invalid-provider-id":return"This auth provider is not configured correctly in Firebase.";case"auth/network-request-failed":return"Network error contacting Firebase Auth.";default:return"Authentication failed. Check Firebase Auth provider setup."}if("firestore"===c)switch(d){case"permission-denied":return"Firestore permission denied. Ensure signed-in users can read/write workspace docs in Firestore rules.";case"unavailable":return"Firestore is temporarily unavailable.";case"failed-precondition":return"Firestore operation failed precondition. Verify indexes/rules are deployed.";default:return"Firestore request failed."}switch(d){case"storage/unauthorized":return"Storage permission denied. Update Firebase Storage rules for authenticated users.";case"storage/object-not-found":return"The requested storage object was not found.";default:return"Firebase Storage request failed."}}return a instanceof Error&&a.message?a.message:"Unexpected Firebase error."}a.s(["mapFirebaseError",()=>c])},91123,a=>{"use strict";a.i(69387);var b=a.i(60574);a.i(60121);var c=a.i(5420),d=a.i(8876),e=a.i(53653);let f=[],g=new Set,h=new Map;function i(){let a=[...f].sort((a,b)=>a.name.localeCompare(b.name));for(let b of g)b(a)}async function j(a,b,f){if(!d.firebaseStorage)return"";let g=`workspaces/${a}/companies/${b}/cover/${Date.now()}-${f.name}`,h=(0,c.ref)(d.firebaseStorage,g);try{return await (0,c.uploadBytes)(h,f),(0,c.getDownloadURL)(h)}catch(a){throw Error((0,e.mapFirebaseError)(a,"storage"))}}async function k(a){var c;let g,h=(c=a,g=new Date().toISOString(),{id:`company-${crypto.randomUUID().slice(0,8)}`,workspaceId:c.workspaceId,name:c.name.trim(),slug:c.name.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),status:"draft",completionScore:0,coverAssetUrl:"",branding:{primary:c.branding.primary,secondary:c.branding.secondary||"",accent:c.branding.accent||""},memberCount:0,sections:{identity:{legalName:"",tagline:"",mission:"",mascot:"",primaryColors:[c.branding.primary]},voice:{tone:"",dos:[],donts:[],ctaStyle:"",examples:[]},visual:{styleKeywords:[],typography:"",layoutDirection:"",moodReferences:[]},audience:{primaryPersona:"",geographies:[],keyObjections:[],desiredPerception:""},content:{pillars:[],formats:[],cadence:"",goals:[],prohibitedTopics:[]}},promptPacks:{identity:[],voice:[],visual:[],audience:[],content:[]},aiContextCompiled:"",assets:[],createdBy:c.userId,updatedBy:c.userId,createdAt:g,updatedAt:g});if(a.coverFile&&(h.coverAssetUrl=await j(a.workspaceId,h.id,a.coverFile)),!d.firestore)return f.push(h),i(),h;try{let c=(0,b.collection)(d.firestore,"workspaces",a.workspaceId,"companies");await (0,b.setDoc)((0,b.doc)(c,h.id),h);let e=new Date().toISOString(),f={id:a.userId,workspaceId:a.workspaceId,companyId:h.id,email:(a.userEmail||`${a.userId}@local.test`).trim().toLowerCase(),uid:a.userId,name:"Workspace Owner",role:"admin",status:"active",invitedBy:a.userId,invitedAt:e,joinedAt:e};return await (0,b.setDoc)((0,b.doc)(d.firestore,"workspaces",a.workspaceId,"companies",h.id,"members",a.userId),f,{merge:!0}),h}catch(a){throw Error((0,e.mapFirebaseError)(a,"firestore"))}}async function l(a){let c=d.firestore;if(c)try{let d=(0,b.collection)(c,"workspaces",a.workspaceId,"companies"),e=await (0,b.getDocs)((0,b.query)(d,(0,b.where)("createdBy","==",a.uid)));if(!e.docs.length)return;let f=new Date().toISOString(),g=(a.email||`${a.uid}@local.test`).trim().toLowerCase();for(let d of e.docs){let e=d.data(),h=(0,b.doc)(c,"workspaces",a.workspaceId,"companies",e.id,"members",a.uid);if((await (0,b.getDoc)(h)).exists())continue;let i={id:a.uid,workspaceId:a.workspaceId,companyId:e.id,email:g,uid:a.uid,name:"Workspace Owner",role:"admin",status:"active",invitedBy:a.uid,invitedAt:f,joinedAt:f};await (0,b.setDoc)(h,i,{merge:!0})}}catch{}}function m(a,c,h,i){let j=d.firestore;if(!j)return g.add(h),h([...f].sort((a,b)=>a.name.localeCompare(b.name))),()=>{g.delete(h)};if(!c)return h([]),()=>void 0;let k=new Map,l=new Map;function m(){h([...k.values()].sort((a,b)=>a.name.localeCompare(b.name)))}let n=(0,b.query)((0,b.collectionGroup)(j,"members"),(0,b.where)("uid","==",c),(0,b.where)("workspaceId","==",a),(0,b.where)("status","==","active")),o=(0,b.onSnapshot)(n,c=>{let d=new Set;for(let a of c.docs){let b=a.data();b.companyId&&d.add(String(b.companyId))}for(let[a,b]of l.entries())d.has(a)||(b(),l.delete(a),k.delete(a));for(let c of d){if(l.has(c))continue;let d=(0,b.doc)(j,"workspaces",a,"companies",c),f=(0,b.onSnapshot)(d,a=>{if(!a.exists()){k.delete(c),m();return}k.set(c,a.data()),m()},a=>i?.((0,e.mapFirebaseError)(a,"firestore")));l.set(c,f)}m()},a=>{i?.((0,e.mapFirebaseError)(a,"firestore"))});return()=>{for(let a of(o(),l.values()))a();l.clear(),k.clear()}}async function n(a,c,g){if(!d.firestore){let a=f.findIndex(a=>a.id===c);a>=0&&(f[a]={...f[a],...g,updatedAt:new Date().toISOString()},i());return}try{let e=(0,b.doc)(d.firestore,"workspaces",a,"companies",c);await (0,b.updateDoc)(e,{...g,updatedAt:new Date().toISOString()})}catch(a){throw Error((0,e.mapFirebaseError)(a,"firestore"))}}async function o(a,c){if(!d.firestore)return f.find(a=>a.id===c)||null;try{let e=(0,b.doc)(d.firestore,"workspaces",a,"companies",c),f=await (0,b.getDoc)(e);if(!f.exists())return null;return f.data()}catch{return null}}async function p(a,c,e){if(!d.firestore)return void h.set(a,{lastActiveWorkspaceId:c,lastActiveCompanyId:e||void 0});try{let f=(0,b.doc)(d.firestore,"users",a,"preferences","app");await (0,b.setDoc)(f,{lastActiveWorkspaceId:c,lastActiveCompanyId:e,updatedAt:new Date().toISOString()},{merge:!0})}catch{return}}async function q(a){if(!d.firestore)return h.get(a)||{lastActiveWorkspaceId:"",lastActiveCompanyId:""};try{let c=(0,b.doc)(d.firestore,"users",a,"preferences","app"),e=await (0,b.getDoc)(c);if(!e.exists())return{lastActiveWorkspaceId:"",lastActiveCompanyId:""};return e.data()}catch{return{lastActiveWorkspaceId:"",lastActiveCompanyId:""}}}async function r(a,b,c){let d=await o(a,b);if(!d)return;let e=Math.max(0,(d.memberCount||0)+c);await n(a,b,{memberCount:e})}a.s(["bootstrapCompanyCreatorMemberships",()=>l,"createCompany",()=>k,"getUserCompanyPreference",()=>q,"incrementCompanyMemberCount",()=>r,"setUserCompanyPreference",()=>p,"subscribeCompanies",()=>m,"updateCompany",()=>n])},6977,45061,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(8876),d=a.i(91123),e=a.i(53653);let f={},g=new Map;function h(a,b){return`${a}:${b}`}function i(a,b){let c=h(a,b),d=g.get(c);if(!d)return;let e=f[c]||[];for(let a of d)a(e)}function j(a,d,i,j){if(!c.firestore){let b=h(a,d),c=g.get(b)||new Set;return c.add(i),g.set(b,c),i(f[b]||[]),()=>{let a=g.get(b);a&&a.delete(i)}}let k=(0,b.collection)(c.firestore,"workspaces",a,"companies",d,"members");return(0,b.onSnapshot)(k,a=>{let b=a.docs.map(a=>a.data()),c=new Map;for(let a of b){let b=(a.email||"").trim().toLowerCase();if(!b)continue;let d=c.get(b);if(!d){c.set(b,a);continue}let e="active"===d.status?2:+("pending"===d.status),f="active"===a.status?2:+("pending"===a.status);if(f>e){c.set(b,a);continue}f===e&&a.uid&&!d.uid&&c.set(b,a)}i(Array.from(c.values()).sort((a,b)=>a.email.localeCompare(b.email)))},a=>{j?.((0,e.mapFirebaseError)(a,"firestore"))})}async function k(a,g,j){let k=new Date().toISOString(),l=j.email.trim().toLowerCase(),m={id:`email-${l.replace(/[^a-z0-9]+/g,"-")}`,workspaceId:a,companyId:g,email:l,role:j.role,status:"pending",invitedBy:j.invitedBy,invitedAt:k};if(!c.firestore){let b=h(a,g),c=f[b]||[];return c.some(a=>a.email===m.email)||(f[b]=[m,...c],await (0,d.incrementCompanyMemberCount)(a,g,1),i(a,g)),m}try{let e=(0,b.doc)(c.firestore,"workspaces",a,"companies",g,"members",m.id),f=await (0,b.getDoc)(e);return await (0,b.setDoc)(e,m,{merge:!0}),f.exists()||await (0,d.incrementCompanyMemberCount)(a,g,1),m}catch(a){throw Error((0,e.mapFirebaseError)(a,"firestore"))}}async function l(a,d,g,j,k,m="viewer"){if(!c.firestore){let b=f[h(a,d)]||[],c=b.findIndex(a=>a.email===g.toLowerCase());c>=0&&(b[c]={...b[c],status:"active",role:m,uid:j,name:k||b[c].name||"",joinedAt:new Date().toISOString()},i(a,d));return}try{let e=(0,b.doc)(c.firestore,"workspaces",a,"companies",d,"members",j);await (0,b.setDoc)(e,{id:j,workspaceId:a,companyId:d,email:g.toLowerCase(),uid:j,name:k||"",role:m,status:"active",invitedBy:j,invitedAt:new Date().toISOString(),joinedAt:new Date().toISOString()},{merge:!0})}catch(a){throw Error((0,e.mapFirebaseError)(a,"firestore"))}}async function m(a,d,g,j){if(!c.firestore){let b=f[h(a,d)]||[],c=b.findIndex(a=>a.id===g);c>=0&&(b[c]={...b[c],role:j},i(a,d));return}try{let e=(0,b.doc)(c.firestore,"workspaces",a,"companies",d,"members",g);await (0,b.updateDoc)(e,{role:j})}catch(a){throw Error((0,e.mapFirebaseError)(a,"firestore"))}}a.s(["activateMemberByEmail",()=>l,"addPendingMember",()=>k,"subscribeCompanyMembers",()=>j,"updateMemberRole",()=>m],6977);let n=new Map;async function o(a){var d,e;let f=new Date().toISOString(),g=(d=a.workspaceId,e=a.uid,`${d}:${e}`);if(!c.firestore){n.has(g)||n.set(g,{uid:a.uid,email:a.email.trim().toLowerCase(),workspaceRole:"viewer",status:"active",companyRoles:{},createdAt:f,updatedAt:f});return}let h=(0,b.doc)(c.firestore,"workspaces",a.workspaceId,"user_roles",a.uid);(await (0,b.getDoc)(h)).exists()||await (0,b.setDoc)(h,{uid:a.uid,email:a.email.trim().toLowerCase(),workspaceRole:"viewer",status:"active",companyRoles:{},createdAt:f,updatedAt:f})}a.s(["ensureWorkspaceUserAccess",()=>o],45061)},67909,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(89195),e=a.i(91123),f=a.i(6977),g=a.i(45061),h=a.i(22168);function i(a,b){let c=(a||"").trim();return/^#[0-9a-fA-F]{6}$/.test(c)?c:/^#[0-9a-fA-F]{3}$/.test(c)?`#${c[1]}${c[1]}${c[2]}${c[2]}${c[3]}${c[3]}`:b}function j(a){let b=i(a,"#5ba0ff").slice(1);return{r:Number.parseInt(b.slice(0,2),16),g:Number.parseInt(b.slice(2,4),16),b:Number.parseInt(b.slice(4,6),16)}}function k(a,b){let{r:c,g:d,b:e}=j(a);return`rgba(${c}, ${d}, ${e}, ${b})`}function l(a,b){let{r:c,g:d,b:e}=j(a),f=a=>Math.min(255,Math.round(a+(255-a)*b));return`#${[f(c),f(d),f(e)].map(a=>a.toString(16).padStart(2,"0")).join("")}`}function m({children:a}){let{user:j,loading:m}=(0,d.useAuth)(),[n,o]=(0,c.useState)(!1),{appContext:p,setAppContext:q,companies:r,setCompanies:s,setActiveCompany:t,markCompanyGateSeen:u,setMembersByCompany:v}=(0,h.useAppState)();return(0,c.useEffect)(()=>{if(!j)return;let a=!0;return(0,e.getUserCompanyPreference)(j.uid).then(b=>{a&&(q(a=>({...a,workspaceId:b.lastActiveWorkspaceId||a.workspaceId||"workspace-primary",userId:j.uid})),b.lastActiveCompanyId&&t(b.lastActiveCompanyId))}),()=>{a=!1}},[t,q,j]),(0,c.useEffect)(()=>{if(!j||m)return void o(!1);let a=!0;return(0,g.ensureWorkspaceUserAccess)({workspaceId:p.workspaceId,uid:j.uid,email:j.email||`${j.uid}@local.test`}).then(()=>{a&&o(!0)}).catch(()=>{a&&o(!0)}),()=>{a=!1}},[p.workspaceId,m,j]),(0,c.useEffect)(()=>{if(j&&!m&&n)return(0,e.bootstrapCompanyCreatorMemberships)({workspaceId:p.workspaceId,uid:j.uid,email:j.email||void 0}).catch(()=>void 0),(0,e.subscribeCompanies)(p.workspaceId,j.uid,a=>s(a),a=>{console.warn("[companies] subscribe failed:",a),s([])})},[n,p.workspaceId,m,s,j]),(0,c.useEffect)(()=>{if(j&&p.activeCompanyId)return(0,e.setUserCompanyPreference)(j.uid,p.workspaceId,p.activeCompanyId).catch(()=>void 0),(0,f.subscribeCompanyMembers)(p.workspaceId,p.activeCompanyId,a=>{v(b=>({...b,[p.activeCompanyId]:a}))})},[p.activeCompanyId,p.workspaceId,v,j]),(0,c.useEffect)(()=>{if(j){if(!r.length){p.activeCompanyId&&t(null),p.companyGateSeenInSession||u(!0);return}if(1===r.length){let a=r[0].id;p.activeCompanyId!==a&&t(a),p.companyGateSeenInSession||u(!0);return}p.activeCompanyId&&!r.some(a=>a.id===p.activeCompanyId)&&(t(null),p.companyGateSeenInSession&&u(!1))}},[p.activeCompanyId,p.companyGateSeenInSession,r,u,t,j]),(0,c.useEffect)(()=>{!function(a){let b,c,d;if("u"<typeof document)return;let e=(b=i(a?.branding.primary||"#5ba0ff","#5ba0ff"),c=i(a?.branding.secondary||l(b,.18),l(b,.18)),d=i(a?.branding.accent||l(b,.32),l(b,.32)),{primary:b,secondary:c,accent:d,glow:k(b,.28),glowSoft:k(d,.16),border:k(d,.42),panelTint:k(b,.12)}),f=document.documentElement;f.style.setProperty("--company-primary",e.primary),f.style.setProperty("--company-secondary",e.secondary),f.style.setProperty("--company-accent",e.accent),f.style.setProperty("--company-glow",e.glow),f.style.setProperty("--company-glow-soft",e.glowSoft),f.style.setProperty("--company-border",e.border),f.style.setProperty("--company-panel-tint",e.panelTint)}(r.find(a=>a.id===p.activeCompanyId)||null)},[p.activeCompanyId,r]),(0,b.jsx)(b.Fragment,{children:a})}function n({children:a}){return(0,b.jsx)(d.AuthProvider,{children:(0,b.jsx)(h.AppStateProvider,{children:(0,b.jsx)(m,{children:a})})})}a.s(["Providers",()=>n],67909)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1286ae8c._.js.map