(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93842,e=>{"use strict";var t=e.i(43476);function a({title:e,subtitle:a,actions:i}){return(0,t.jsxs)("header",{className:"page-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:e}),(0,t.jsx)("p",{children:a})]}),i?(0,t.jsx)("div",{className:"page-actions",children:i}):null]})}e.s(["PageHeader",()=>a])},74886,e=>{"use strict";let t=(0,e.i(75254).default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["Copy",()=>t],74886)},14764,e=>{"use strict";let t=(0,e.i(75254).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>t],14764)},96230,e=>{"use strict";e.i(36180);var t=e.i(98925),a=e.i(67426),i=e.i(9376),n=e.i(40558),s=e.i(75224);let r=[],o=new Map;function c(e,t){let a=`${e}:${t}`,i=o.get(a);if(!i)return;let n=r.filter(a=>a.workspaceId===e&&a.companyId===t);for(let e of i)e(n)}function l(e,n,s,c){if(!a.firestore){let t=`${e}:${n}`,a=o.get(t)||new Set;return a.add(s),o.set(t,a),s(r.filter(t=>t.workspaceId===e&&t.companyId===n)),()=>{let e=o.get(t);e&&e.delete(s)}}let l=(0,t.collection)(a.firestore,"workspaces",e,"companies",n,"invites");return(0,t.onSnapshot)(l,e=>{s(e.docs.map(e=>e.data()).sort((e,t)=>t.createdAt.localeCompare(e.createdAt)))},e=>{c?.((0,i.mapFirebaseError)(e,"firestore"))})}function d(e){return`${"http://localhost:3000".replace(/\/+$/,"")}/invite/${e}`}async function p(e,s,o){let l=new Date,d=new Date(l.getTime()+6048e5).toISOString(),p={id:"",companyId:s,email:o.email.trim().toLowerCase(),role:o.role,token:crypto.randomUUID().replace(/-/g,""),status:"pending",expiresAt:d,createdAt:l.toISOString(),createdBy:o.createdBy};if(p.id=p.token,await (0,n.addPendingMember)(e,s,{email:p.email,role:p.role,invitedBy:p.createdBy}),!a.firestore)return r.unshift({...p,workspaceId:e}),c(e,s),p;try{let i=(0,t.doc)(a.firestore,"workspaces",e,"companies",s,"invites",p.token);return await (0,t.setDoc)(i,p,{merge:!0}),await (0,t.setDoc)((0,t.doc)(a.firestore,"invite_tokens",p.token),{...p,workspaceId:e,companyId:s},{merge:!0}),p}catch(e){throw Error((0,i.mapFirebaseError)(e,"firestore"))}}async function m(e){if(!a.firestore){let t=r.find(t=>t.token===e);return t?{workspaceId:t.workspaceId,invite:t}:null}try{let i=(0,t.doc)(a.firestore,"invite_tokens",e),n=await (0,t.getDoc)(i);if(n.exists()){let t=n.data();return{workspaceId:t.workspaceId,companyId:t.companyId,inviteId:e,ref:i,invite:t}}let s=(0,t.query)((0,t.collectionGroup)(a.firestore,"invites"),(0,t.where)("token","==",e),(0,t.limit)(1)),r=await (0,t.getDocs)(s);if(!r.docs.length)return null;let o=r.docs[0],c=o.data(),l=o.ref.parent.parent,d=l?.parent.parent;if(!l||!d)return null;return{workspaceId:d.id,companyId:l.id,inviteId:o.id,ref:o.ref,invite:c}}catch{return null}}async function u(e,i){let o=await m(e);if(!o)return{ok:!1,reason:"Invite not found"};let l=o.invite;if("pending"!==l.status)return{ok:!1,reason:"Invite already used or revoked"};if(l.email.toLowerCase()!==i.email.toLowerCase())return{ok:!1,reason:"Signed-in email does not match invite email"};if(new Date(l.expiresAt).getTime()<Date.now()){if(a.firestore){try{await (0,t.updateDoc)((0,t.doc)(a.firestore,"invite_tokens",e),{status:"expired"})}catch{}try{let i=o.workspaceId,n="companyId"in o&&o.companyId?o.companyId:l.companyId;n&&await (0,t.updateDoc)((0,t.doc)(a.firestore,"workspaces",i,"companies",n,"invites",e),{status:"expired"})}catch{}}return{ok:!1,reason:"Invite expired"}}let d=o.workspaceId,p="companyId"in o&&o.companyId?o.companyId:l.companyId;if(!p)return{ok:!1,reason:"Invite is missing company id"};if(await (0,s.ensureWorkspaceUserAccess)({workspaceId:d,uid:i.uid,email:i.email||`${i.uid}@local.test`}),a.firestore){let n=(0,t.doc)(a.firestore,"workspaces",d,"companies",p,"members",i.uid);await (0,t.setDoc)(n,{id:i.uid,workspaceId:d,companyId:p,email:l.email.toLowerCase(),uid:i.uid,name:i.name||"",role:l.role,status:"active",invitedBy:l.createdBy,invitedAt:l.createdAt,joinedAt:new Date().toISOString(),inviteToken:e},{merge:!0}),await (0,t.updateDoc)((0,t.doc)(a.firestore,"invite_tokens",e),{status:"accepted",acceptedByUid:i.uid}),await (0,t.updateDoc)((0,t.doc)(a.firestore,"workspaces",d,"companies",p,"invites",e),{status:"accepted",acceptedByUid:i.uid})}else{await (0,n.activateMemberByEmail)(d,p,l.email,i.uid,i.name||"",l.role);let t=r.find(t=>t.token===e);t&&(t.status="accepted",t.acceptedByUid=i.uid,c(d,p))}return{ok:!0,workspaceId:d,companyId:p}}e.s(["acceptInviteByToken",()=>u,"buildInviteUrl",()=>d,"createCompanyInvite",()=>p,"subscribeCompanyInvites",()=>l])},11850,e=>{"use strict";var t=e.i(43476),a=e.i(22016),i=e.i(71645),n=e.i(92989),s=e.i(74886),r=e.i(14764),o=e.i(3638),c=e.i(96230),l=e.i(40558);function d({companyId:e}){let{appContext:a,setMembersByCompany:n}=(0,o.useAppState)(),[d,p]=(0,i.useState)([]),[m,u]=(0,i.useState)([]),[h,f]=(0,i.useState)(""),[v,y]=(0,i.useState)("client"),[x,w]=(0,i.useState)(null);async function j(){if(!h.trim())return void w("Email is required.");w(null);try{await (0,c.createCompanyInvite)(a.workspaceId,e,{email:h,role:v,createdBy:a.userId}),f(""),w("Invite created. Share the invite link below.")}catch(e){w(e instanceof Error?e.message:"Could not create invite")}}async function g(t,i){w(null);try{await (0,l.updateMemberRole)(a.workspaceId,e,t,i),w("Member role updated.")}catch(e){w(e instanceof Error?e.message:"Could not update member role")}}return(0,i.useEffect)(()=>(0,l.subscribeCompanyMembers)(a.workspaceId,e,t=>{p(t),n(a=>({...a,[e]:t}))},e=>w(e)),[a.workspaceId,e,n]),(0,i.useEffect)(()=>(0,c.subscribeCompanyInvites)(a.workspaceId,e,u,e=>w(e)),[a.workspaceId,e]),(0,t.jsxs)("section",{className:"panel",children:[(0,t.jsx)("h3",{children:"Company members"}),(0,t.jsxs)("div",{className:"form-grid two-col",children:[(0,t.jsxs)("label",{className:"two-col-span",children:[(0,t.jsx)("span",{children:"Client email"}),(0,t.jsx)("input",{value:h,onChange:e=>f(e.target.value),placeholder:"client@company.com"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("span",{children:"Role"}),(0,t.jsxs)("select",{value:v,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"viewer",children:"Viewer"}),(0,t.jsx)("option",{value:"client",children:"Client"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("span",{children:"Pending invites"}),(0,t.jsx)("input",{readOnly:!0,value:String(m.filter(e=>"pending"===e.status).length)})]})]}),(0,t.jsx)("div",{className:"button-row",children:(0,t.jsxs)("button",{type:"button",className:"btn-primary",onClick:j,children:[(0,t.jsx)(r.Send,{className:"h-4 w-4"})," Send invite"]})}),(0,t.jsx)("div",{className:"member-management-list",children:d.length?d.map(e=>(0,t.jsxs)("div",{className:"selector-member-row",children:[(0,t.jsx)("span",{children:e.name||e.email}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("select",{value:e.role,onChange:t=>g(e.id,t.target.value),className:"h-8 rounded-md border border-[var(--border)] bg-[var(--panel-soft)] px-2 text-xs",children:[(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"viewer",children:"Viewer"}),(0,t.jsx)("option",{value:"client",children:"Client"})]}),(0,t.jsx)("span",{className:"badge",children:e.status})]})]},e.id)):(0,t.jsx)("p",{className:"text-sm text-[var(--muted)]",children:"No members yet for this company."})}),m.length?(0,t.jsx)("div",{className:"member-management-list",children:m.slice(0,8).map(e=>{let a=(0,c.buildInviteUrl)(e.token);return(0,t.jsxs)("div",{className:"selector-member-row",children:[(0,t.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:e.email}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"badge",children:[e.role," | ",e.status]}),(0,t.jsxs)("button",{type:"button",className:"btn-ghost",onClick:async()=>{try{await navigator.clipboard.writeText(a),w(`Invite link copied for ${e.email}.`)}catch{w("Could not copy invite link.")}},children:[(0,t.jsx)(s.Copy,{className:"h-4 w-4"})," Copy link"]})]})]},e.id)})}):null,x?(0,t.jsx)("p",{className:"text-sm text-[var(--muted)]",children:x}):null]})}var p=e.i(64242);function m(e){return JSON.stringify(e,null,2)}function u(e,t){try{return JSON.parse(e)}catch{return t}}function h({initialCompany:e}){let{appContext:a,setCompanies:n}=(0,o.useAppState)(),[s,r]=(0,i.useState)(e),[c,l]=(0,i.useState)(!1),[d,h]=(0,i.useState)(null),f=(0,i.useMemo)(()=>["identity","voice","visual","audience","content"],[]);async function v(){l(!0),h(null);try{let e=Math.min(100,Math.round(f.reduce((e,t)=>{let a=Object.values(s.sections[t]).some(e=>Array.isArray(e)?e.length>0:String(e||"").trim().length>0);return e+20*!!a},0)/100*100)),t={...s,completionScore:e,aiContextCompiled:`Brand: ${s.name} | Identity: ${s.sections.identity.tagline||"n/a"} | Voice: ${s.sections.voice.tone||"n/a"} | Visual: ${s.sections.visual.styleKeywords.join(", ")||"n/a"} | Audience: ${s.sections.audience.primaryPersona||"n/a"} | Content pillars: ${s.sections.content.pillars.join(", ")||"n/a"}`,updatedAt:new Date().toISOString(),updatedBy:a.userId};await (0,p.updateCompany)(a.workspaceId,s.id,t),r(t),n(e=>e.map(e=>e.id===t.id?t:e)),h("Saved profile changes.")}catch(e){h(e instanceof Error?e.message:"Save failed")}finally{l(!1)}}return(0,t.jsxs)("section",{className:"grid-two",children:[f.map(e=>(0,t.jsxs)("article",{className:"panel",children:[(0,t.jsx)("h3",{children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,t.jsx)("p",{className:"text-sm text-[var(--muted)]",children:"Edit section JSON directly for now."}),(0,t.jsx)("textarea",{value:m(s.sections[e]),onChange:t=>{let a=u(t.target.value,s.sections[e]);r(t=>({...t,sections:{...t.sections,[e]:a}}))}})]},e)),(0,t.jsxs)("article",{className:"panel two-col-span",children:[(0,t.jsx)("h3",{children:"Prompt packs"}),(0,t.jsx)("textarea",{value:m(s.promptPacks),onChange:e=>{let t=u(e.target.value,s.promptPacks);r(e=>({...e,promptPacks:t}))}}),(0,t.jsx)("div",{className:"button-row",children:(0,t.jsx)("button",{className:"btn-primary",type:"button",onClick:v,disabled:c,children:c?"Saving...":"Save Company Profile"})}),d?(0,t.jsx)("p",{className:"text-sm text-[var(--muted)]",children:d}):null]})]})}var f=e.i(93842);function v(){let e=(0,n.useParams)(),{companies:s,setActiveCompany:r,markCompanyGateSeen:c}=(0,o.useAppState)(),l=s.find(t=>t.id===e.companyId)||null;return((0,i.useEffect)(()=>{l&&(r(l.id),c(!0))},[l,c,r]),l)?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(f.PageHeader,{title:l.name,subtitle:`Brand profile | ${l.completionScore}% complete`,actions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.default,{className:"btn-ghost",href:`/companies/${l.id}/integrations`,children:"Manage Integrations"}),(0,t.jsx)(a.default,{className:"btn-primary",href:`/companies/${l.id}/intake`,children:"Open Intake Wizard"})]})}),(0,t.jsx)(d,{companyId:l.id}),(0,t.jsx)(h,{initialCompany:l})]}):(0,t.jsxs)("section",{className:"panel",children:[(0,t.jsx)("h3",{children:"Company not found"}),(0,t.jsx)("p",{children:"This company may have been removed or is not loaded in the current workspace."}),(0,t.jsxs)("div",{className:"button-row",children:[(0,t.jsx)(a.default,{className:"btn-primary",href:"/select-company",children:"Select company"}),(0,t.jsx)(a.default,{className:"btn-ghost",href:"/companies",children:"Back to companies"})]})]})}e.s(["default",()=>v],11850)}]);