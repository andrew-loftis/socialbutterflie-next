(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3638,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(95938);let i="sb_active_company_id",o="sb_company_gate_seen",s={workspaceId:"workspace-primary",userId:"anonymous",role:"viewer",activeCompanyId:null,companyGateSeenInSession:!1};function n(){return{...s,activeCompanyId:window.sessionStorage.getItem(i),companyGateSeenInSession:"1"===window.sessionStorage.getItem(o)}}let c=(0,r.createContext)(null);function d({children:e}){let{user:d}=(0,a.useAuth)(),[u,p]=(0,r.useState)(n),[l,m]=(0,r.useState)([]),[f,w]=(0,r.useState)({}),[y,v]=(0,r.useState)(null),g=(0,r.useMemo)(()=>({...u,userId:d?.uid||s.userId,role:d?"editor":"viewer"}),[u,d]),I=(0,r.useMemo)(()=>({appContext:g,setAppContext:p,companies:l,setCompanies:m,membersByCompany:f,setMembersByCompany:w,setActiveCompany:e=>{p(t=>({...t,activeCompanyId:e})),e?window.sessionStorage.setItem(i,e):window.sessionStorage.removeItem(i)},markCompanyGateSeen:e=>{p(t=>({...t,companyGateSeenInSession:e})),window.sessionStorage.setItem(o,e?"1":"0")},inspector:y,setInspector:v}),[g,l,f,y]);return(0,t.jsx)(c.Provider,{value:I,children:e})}function u(){let e=(0,r.useContext)(c);if(!e)throw Error("useAppState must be used inside AppStateProvider");return e}e.s(["AppStateProvider",()=>d,"useAppState",()=>u])},9376,e=>{"use strict";e.i(14539);var t=e.i(76510);function r(e,r){if(e instanceof t.FirebaseError){var a=e.code;if("auth"===r)switch(a){case"auth/invalid-credential":case"auth/wrong-password":case"auth/user-not-found":return"Invalid email or password.";case"auth/email-already-in-use":return"That email is already registered. Sign in instead.";case"auth/invalid-email":return"Enter a valid email address.";case"auth/weak-password":return"Password must be at least 6 characters.";case"auth/operation-not-allowed":return"Enable this sign-in provider in Firebase Auth -> Sign-in method.";case"auth/account-exists-with-different-credential":return"An account already exists with a different sign-in provider for this email.";case"auth/popup-blocked":return"Popup was blocked by the browser. Allow popups and try again.";case"auth/popup-closed-by-user":return"Sign-in popup was closed before finishing.";case"auth/unauthorized-domain":return"This domain is not authorized in Firebase Auth settings.";case"auth/invalid-provider-id":return"This auth provider is not configured correctly in Firebase.";case"auth/network-request-failed":return"Network error contacting Firebase Auth.";default:return"Authentication failed. Check Firebase Auth provider setup."}if("firestore"===r)switch(a){case"permission-denied":return"Firestore permission denied. Ensure signed-in users can read/write workspace docs in Firestore rules.";case"unavailable":return"Firestore is temporarily unavailable.";case"failed-precondition":return"Firestore operation failed precondition. Verify indexes/rules are deployed.";default:return"Firestore request failed."}switch(a){case"storage/unauthorized":return"Storage permission denied. Update Firebase Storage rules for authenticated users.";case"storage/object-not-found":return"The requested storage object was not found.";default:return"Firebase Storage request failed."}}return e instanceof Error&&e.message?e.message:"Unexpected Firebase error."}e.s(["mapFirebaseError",()=>r])},64242,e=>{"use strict";e.i(36180);var t=e.i(98925);e.i(61086);var r=e.i(27215),a=e.i(67426),i=e.i(9376);let o=[],s=new Set,n=new Map;function c(){let e=[...o].sort((e,t)=>e.name.localeCompare(t.name));for(let t of s)t(e)}async function d(e,t,o){if(!a.firebaseStorage)return"";let s=`workspaces/${e}/companies/${t}/cover/${Date.now()}-${o.name}`,n=(0,r.ref)(a.firebaseStorage,s);try{return await (0,r.uploadBytes)(n,o),(0,r.getDownloadURL)(n)}catch(e){throw Error((0,i.mapFirebaseError)(e,"storage"))}}async function u(e){var r;let s,n=(r=e,s=new Date().toISOString(),{id:`company-${crypto.randomUUID().slice(0,8)}`,workspaceId:r.workspaceId,name:r.name.trim(),slug:r.name.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),status:"draft",completionScore:0,coverAssetUrl:"",branding:{primary:r.branding.primary,secondary:r.branding.secondary||"",accent:r.branding.accent||""},memberCount:0,sections:{identity:{legalName:"",tagline:"",mission:"",mascot:"",primaryColors:[r.branding.primary]},voice:{tone:"",dos:[],donts:[],ctaStyle:"",examples:[]},visual:{styleKeywords:[],typography:"",layoutDirection:"",moodReferences:[]},audience:{primaryPersona:"",geographies:[],keyObjections:[],desiredPerception:""},content:{pillars:[],formats:[],cadence:"",goals:[],prohibitedTopics:[]}},promptPacks:{identity:[],voice:[],visual:[],audience:[],content:[]},aiContextCompiled:"",assets:[],createdBy:r.userId,updatedBy:r.userId,createdAt:s,updatedAt:s});if(e.coverFile&&(n.coverAssetUrl=await d(e.workspaceId,n.id,e.coverFile)),!a.firestore)return o.push(n),c(),n;try{let r=(0,t.collection)(a.firestore,"workspaces",e.workspaceId,"companies");await (0,t.setDoc)((0,t.doc)(r,n.id),n);let i=new Date().toISOString(),o={id:e.userId,workspaceId:e.workspaceId,companyId:n.id,email:(e.userEmail||`${e.userId}@local.test`).trim().toLowerCase(),uid:e.userId,name:"Workspace Owner",role:"admin",status:"active",invitedBy:e.userId,invitedAt:i,joinedAt:i};return await (0,t.setDoc)((0,t.doc)(a.firestore,"workspaces",e.workspaceId,"companies",n.id,"members",e.userId),o,{merge:!0}),n}catch(e){throw Error((0,i.mapFirebaseError)(e,"firestore"))}}async function p(e){let r=a.firestore;if(r)try{let a=(0,t.collection)(r,"workspaces",e.workspaceId,"companies"),i=await (0,t.getDocs)((0,t.query)(a,(0,t.where)("createdBy","==",e.uid)));if(!i.docs.length)return;let o=new Date().toISOString(),s=(e.email||`${e.uid}@local.test`).trim().toLowerCase();for(let a of i.docs){let i=a.data(),n=(0,t.doc)(r,"workspaces",e.workspaceId,"companies",i.id,"members",e.uid);if((await (0,t.getDoc)(n)).exists())continue;let c={id:e.uid,workspaceId:e.workspaceId,companyId:i.id,email:s,uid:e.uid,name:"Workspace Owner",role:"admin",status:"active",invitedBy:e.uid,invitedAt:o,joinedAt:o};await (0,t.setDoc)(n,c,{merge:!0})}}catch{}}function l(e,r,n,c){let d=a.firestore;if(!d)return s.add(n),n([...o].sort((e,t)=>e.name.localeCompare(t.name))),()=>{s.delete(n)};if(!r)return n([]),()=>void 0;let u=new Map,p=new Map;function l(){n([...u.values()].sort((e,t)=>e.name.localeCompare(t.name)))}let m=(0,t.query)((0,t.collectionGroup)(d,"members"),(0,t.where)("uid","==",r),(0,t.where)("workspaceId","==",e),(0,t.where)("status","==","active")),f=(0,t.onSnapshot)(m,r=>{let a=new Set;for(let e of r.docs){let t=e.data();t.companyId&&a.add(String(t.companyId))}for(let[e,t]of p.entries())a.has(e)||(t(),p.delete(e),u.delete(e));for(let r of a){if(p.has(r))continue;let a=(0,t.doc)(d,"workspaces",e,"companies",r),o=(0,t.onSnapshot)(a,e=>{if(!e.exists()){u.delete(r),l();return}u.set(r,e.data()),l()},e=>c?.((0,i.mapFirebaseError)(e,"firestore")));p.set(r,o)}l()},e=>{c?.((0,i.mapFirebaseError)(e,"firestore"))});return()=>{for(let e of(f(),p.values()))e();p.clear(),u.clear()}}async function m(e,r,s){if(!a.firestore){let e=o.findIndex(e=>e.id===r);e>=0&&(o[e]={...o[e],...s,updatedAt:new Date().toISOString()},c());return}try{let i=(0,t.doc)(a.firestore,"workspaces",e,"companies",r);await (0,t.updateDoc)(i,{...s,updatedAt:new Date().toISOString()})}catch(e){throw Error((0,i.mapFirebaseError)(e,"firestore"))}}async function f(e,r){if(!a.firestore)return o.find(e=>e.id===r)||null;try{let i=(0,t.doc)(a.firestore,"workspaces",e,"companies",r),o=await (0,t.getDoc)(i);if(!o.exists())return null;return o.data()}catch{return null}}async function w(e,r,i){if(!a.firestore)return void n.set(e,{lastActiveWorkspaceId:r,lastActiveCompanyId:i||void 0});try{let o=(0,t.doc)(a.firestore,"users",e,"preferences","app");await (0,t.setDoc)(o,{lastActiveWorkspaceId:r,lastActiveCompanyId:i,updatedAt:new Date().toISOString()},{merge:!0})}catch{return}}async function y(e){if(!a.firestore)return n.get(e)||{lastActiveWorkspaceId:"",lastActiveCompanyId:""};try{let r=(0,t.doc)(a.firestore,"users",e,"preferences","app"),i=await (0,t.getDoc)(r);if(!i.exists())return{lastActiveWorkspaceId:"",lastActiveCompanyId:""};return i.data()}catch{return{lastActiveWorkspaceId:"",lastActiveCompanyId:""}}}async function v(e,t,r){let a=await f(e,t);if(!a)return;let i=Math.max(0,(a.memberCount||0)+r);await m(e,t,{memberCount:i})}e.s(["bootstrapCompanyCreatorMemberships",()=>p,"createCompany",()=>u,"getUserCompanyPreference",()=>y,"incrementCompanyMemberCount",()=>v,"setUserCompanyPreference",()=>w,"subscribeCompanies",()=>l,"updateCompany",()=>m])},40558,75224,e=>{"use strict";e.i(36180);var t=e.i(98925),r=e.i(67426),a=e.i(64242),i=e.i(9376);let o={},s=new Map;function n(e,t){return`${e}:${t}`}function c(e,t){let r=n(e,t),a=s.get(r);if(!a)return;let i=o[r]||[];for(let e of a)e(i)}function d(e,a,c,d){if(!r.firestore){let t=n(e,a),r=s.get(t)||new Set;return r.add(c),s.set(t,r),c(o[t]||[]),()=>{let e=s.get(t);e&&e.delete(c)}}let u=(0,t.collection)(r.firestore,"workspaces",e,"companies",a,"members");return(0,t.onSnapshot)(u,e=>{let t=e.docs.map(e=>e.data()),r=new Map;for(let e of t){let t=(e.email||"").trim().toLowerCase();if(!t)continue;let a=r.get(t);if(!a){r.set(t,e);continue}let i="active"===a.status?2:+("pending"===a.status),o="active"===e.status?2:+("pending"===e.status);if(o>i){r.set(t,e);continue}o===i&&e.uid&&!a.uid&&r.set(t,e)}c(Array.from(r.values()).sort((e,t)=>e.email.localeCompare(t.email)))},e=>{d?.((0,i.mapFirebaseError)(e,"firestore"))})}async function u(e,s,d){let u=new Date().toISOString(),p=d.email.trim().toLowerCase(),l={id:`email-${p.replace(/[^a-z0-9]+/g,"-")}`,workspaceId:e,companyId:s,email:p,role:d.role,status:"pending",invitedBy:d.invitedBy,invitedAt:u};if(!r.firestore){let t=n(e,s),r=o[t]||[];return r.some(e=>e.email===l.email)||(o[t]=[l,...r],await (0,a.incrementCompanyMemberCount)(e,s,1),c(e,s)),l}try{let i=(0,t.doc)(r.firestore,"workspaces",e,"companies",s,"members",l.id),o=await (0,t.getDoc)(i);return await (0,t.setDoc)(i,l,{merge:!0}),o.exists()||await (0,a.incrementCompanyMemberCount)(e,s,1),l}catch(e){throw Error((0,i.mapFirebaseError)(e,"firestore"))}}async function p(e,a,s,d,u,l="viewer"){if(!r.firestore){let t=o[n(e,a)]||[],r=t.findIndex(e=>e.email===s.toLowerCase());r>=0&&(t[r]={...t[r],status:"active",role:l,uid:d,name:u||t[r].name||"",joinedAt:new Date().toISOString()},c(e,a));return}try{let i=(0,t.doc)(r.firestore,"workspaces",e,"companies",a,"members",d);await (0,t.setDoc)(i,{id:d,workspaceId:e,companyId:a,email:s.toLowerCase(),uid:d,name:u||"",role:l,status:"active",invitedBy:d,invitedAt:new Date().toISOString(),joinedAt:new Date().toISOString()},{merge:!0})}catch(e){throw Error((0,i.mapFirebaseError)(e,"firestore"))}}async function l(e,a,s,d){if(!r.firestore){let t=o[n(e,a)]||[],r=t.findIndex(e=>e.id===s);r>=0&&(t[r]={...t[r],role:d},c(e,a));return}try{let i=(0,t.doc)(r.firestore,"workspaces",e,"companies",a,"members",s);await (0,t.updateDoc)(i,{role:d})}catch(e){throw Error((0,i.mapFirebaseError)(e,"firestore"))}}e.s(["activateMemberByEmail",()=>p,"addPendingMember",()=>u,"subscribeCompanyMembers",()=>d,"updateMemberRole",()=>l],40558);let m=new Map;async function f(e){var a,i;let o=new Date().toISOString(),s=(a=e.workspaceId,i=e.uid,`${a}:${i}`);if(!r.firestore){m.has(s)||m.set(s,{uid:e.uid,email:e.email.trim().toLowerCase(),workspaceRole:"viewer",status:"active",companyRoles:{},createdAt:o,updatedAt:o});return}let n=(0,t.doc)(r.firestore,"workspaces",e.workspaceId,"user_roles",e.uid);(await (0,t.getDoc)(n)).exists()||await (0,t.setDoc)(n,{uid:e.uid,email:e.email.trim().toLowerCase(),workspaceRole:"viewer",status:"active",companyRoles:{},createdAt:o,updatedAt:o})}e.s(["ensureWorkspaceUserAccess",()=>f],75224)},97319,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(95938),i=e.i(64242),o=e.i(40558),s=e.i(75224),n=e.i(3638);function c(e,t){let r=(e||"").trim();return/^#[0-9a-fA-F]{6}$/.test(r)?r:/^#[0-9a-fA-F]{3}$/.test(r)?`#${r[1]}${r[1]}${r[2]}${r[2]}${r[3]}${r[3]}`:t}function d(e){let t=c(e,"#5ba0ff").slice(1);return{r:Number.parseInt(t.slice(0,2),16),g:Number.parseInt(t.slice(2,4),16),b:Number.parseInt(t.slice(4,6),16)}}function u(e,t){let{r,g:a,b:i}=d(e);return`rgba(${r}, ${a}, ${i}, ${t})`}function p(e,t){let{r,g:a,b:i}=d(e),o=e=>Math.min(255,Math.round(e+(255-e)*t));return`#${[o(r),o(a),o(i)].map(e=>e.toString(16).padStart(2,"0")).join("")}`}function l({children:e}){let{user:d,loading:l}=(0,a.useAuth)(),[m,f]=(0,r.useState)(!1),{appContext:w,setAppContext:y,companies:v,setCompanies:g,setActiveCompany:I,markCompanyGateSeen:h,setMembersByCompany:b}=(0,n.useAppState)();return(0,r.useEffect)(()=>{if(!d)return;let e=!0;return(0,i.getUserCompanyPreference)(d.uid).then(t=>{e&&(y(e=>({...e,workspaceId:t.lastActiveWorkspaceId||e.workspaceId||"workspace-primary",userId:d.uid})),!window.sessionStorage.getItem("sb_active_company_id")&&t.lastActiveCompanyId&&I(t.lastActiveCompanyId))}),()=>{e=!1}},[I,y,d]),(0,r.useEffect)(()=>{if(!d||l)return void f(!1);let e=!0;return(0,s.ensureWorkspaceUserAccess)({workspaceId:w.workspaceId,uid:d.uid,email:d.email||`${d.uid}@local.test`}).then(()=>{e&&f(!0)}).catch(()=>{e&&f(!0)}),()=>{e=!1}},[w.workspaceId,l,d]),(0,r.useEffect)(()=>{if(d&&!l&&m)return(0,i.bootstrapCompanyCreatorMemberships)({workspaceId:w.workspaceId,uid:d.uid,email:d.email||void 0}).catch(()=>void 0),(0,i.subscribeCompanies)(w.workspaceId,d.uid,e=>g(e),e=>{console.warn("[companies] subscribe failed:",e),g([])})},[m,w.workspaceId,l,g,d]),(0,r.useEffect)(()=>{if(d&&w.activeCompanyId)return(0,i.setUserCompanyPreference)(d.uid,w.workspaceId,w.activeCompanyId).catch(()=>void 0),(0,o.subscribeCompanyMembers)(w.workspaceId,w.activeCompanyId,e=>{b(t=>({...t,[w.activeCompanyId]:e}))})},[w.activeCompanyId,w.workspaceId,b,d]),(0,r.useEffect)(()=>{if(d){if(!v.length){w.activeCompanyId&&I(null),w.companyGateSeenInSession||h(!0);return}if(1===v.length){let e=v[0].id;w.activeCompanyId!==e&&I(e),w.companyGateSeenInSession||h(!0);return}w.activeCompanyId&&!v.some(e=>e.id===w.activeCompanyId)&&(I(null),w.companyGateSeenInSession&&h(!1))}},[w.activeCompanyId,w.companyGateSeenInSession,v,h,I,d]),(0,r.useEffect)(()=>{!function(e){let t,r,a;if("u"<typeof document)return;let i=(t=c(e?.branding.primary||"#5ba0ff","#5ba0ff"),r=c(e?.branding.secondary||p(t,.18),p(t,.18)),a=c(e?.branding.accent||p(t,.32),p(t,.32)),{primary:t,secondary:r,accent:a,glow:u(t,.28),glowSoft:u(a,.16),border:u(a,.42),panelTint:u(t,.12)}),o=document.documentElement;o.style.setProperty("--company-primary",i.primary),o.style.setProperty("--company-secondary",i.secondary),o.style.setProperty("--company-accent",i.accent),o.style.setProperty("--company-glow",i.glow),o.style.setProperty("--company-glow-soft",i.glowSoft),o.style.setProperty("--company-border",i.border),o.style.setProperty("--company-panel-tint",i.panelTint)}(v.find(e=>e.id===w.activeCompanyId)||null)},[w.activeCompanyId,v]),(0,t.jsx)(t.Fragment,{children:e})}function m({children:e}){return(0,t.jsx)(a.AuthProvider,{children:(0,t.jsx)(n.AppStateProvider,{children:(0,t.jsx)(l,{children:e})})})}e.s(["Providers",()=>m],97319)}]);