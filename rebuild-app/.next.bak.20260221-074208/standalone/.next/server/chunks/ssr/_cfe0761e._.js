module.exports=[51538,a=>{"use strict";var b=a.i(87924);function c({title:a,subtitle:c,actions:d}){return(0,b.jsxs)("header",{className:"page-header",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{children:a}),(0,b.jsx)("p",{children:c})]}),d?(0,b.jsx)("div",{className:"page-actions",children:d}):null]})}a.s(["PageHeader",()=>c])},5151,a=>{"use strict";let b=(0,a.i(70106).default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);a.s(["Copy",()=>b],5151)},92759,a=>{"use strict";let b=(0,a.i(70106).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>b],92759)},93685,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(8876),d=a.i(53653),e=a.i(6977),f=a.i(45061);let g=[],h=new Map;function i(a,b){let c=`${a}:${b}`,d=h.get(c);if(!d)return;let e=g.filter(c=>c.workspaceId===a&&c.companyId===b);for(let a of d)a(e)}function j(a,e,f,i){if(!c.firestore){let b=`${a}:${e}`,c=h.get(b)||new Set;return c.add(f),h.set(b,c),f(g.filter(b=>b.workspaceId===a&&b.companyId===e)),()=>{let a=h.get(b);a&&a.delete(f)}}let j=(0,b.collection)(c.firestore,"workspaces",a,"companies",e,"invites");return(0,b.onSnapshot)(j,a=>{f(a.docs.map(a=>a.data()).sort((a,b)=>b.createdAt.localeCompare(a.createdAt)))},a=>{i?.((0,d.mapFirebaseError)(a,"firestore"))})}function k(a){return`${"http://localhost:3000".replace(/\/+$/,"")}/invite/${a}`}async function l(a,f,h){let j=new Date,k=new Date(j.getTime()+6048e5).toISOString(),l={id:"",companyId:f,email:h.email.trim().toLowerCase(),role:h.role,token:crypto.randomUUID().replace(/-/g,""),status:"pending",expiresAt:k,createdAt:j.toISOString(),createdBy:h.createdBy};if(l.id=l.token,await (0,e.addPendingMember)(a,f,{email:l.email,role:l.role,invitedBy:l.createdBy}),!c.firestore)return g.unshift({...l,workspaceId:a}),i(a,f),l;try{let d=(0,b.doc)(c.firestore,"workspaces",a,"companies",f,"invites",l.token);return await (0,b.setDoc)(d,l,{merge:!0}),await (0,b.setDoc)((0,b.doc)(c.firestore,"invite_tokens",l.token),{...l,workspaceId:a,companyId:f},{merge:!0}),l}catch(a){throw Error((0,d.mapFirebaseError)(a,"firestore"))}}async function m(a){if(!c.firestore){let b=g.find(b=>b.token===a);return b?{workspaceId:b.workspaceId,invite:b}:null}try{let d=(0,b.doc)(c.firestore,"invite_tokens",a),e=await (0,b.getDoc)(d);if(e.exists()){let b=e.data();return{workspaceId:b.workspaceId,companyId:b.companyId,inviteId:a,ref:d,invite:b}}let f=(0,b.query)((0,b.collectionGroup)(c.firestore,"invites"),(0,b.where)("token","==",a),(0,b.limit)(1)),g=await (0,b.getDocs)(f);if(!g.docs.length)return null;let h=g.docs[0],i=h.data(),j=h.ref.parent.parent,k=j?.parent.parent;if(!j||!k)return null;return{workspaceId:k.id,companyId:j.id,inviteId:h.id,ref:h.ref,invite:i}}catch{return null}}async function n(a,d){let h=await m(a);if(!h)return{ok:!1,reason:"Invite not found"};let j=h.invite;if("pending"!==j.status)return{ok:!1,reason:"Invite already used or revoked"};if(j.email.toLowerCase()!==d.email.toLowerCase())return{ok:!1,reason:"Signed-in email does not match invite email"};if(new Date(j.expiresAt).getTime()<Date.now()){if(c.firestore){try{await (0,b.updateDoc)((0,b.doc)(c.firestore,"invite_tokens",a),{status:"expired"})}catch{}try{let d=h.workspaceId,e="companyId"in h&&h.companyId?h.companyId:j.companyId;e&&await (0,b.updateDoc)((0,b.doc)(c.firestore,"workspaces",d,"companies",e,"invites",a),{status:"expired"})}catch{}}return{ok:!1,reason:"Invite expired"}}let k=h.workspaceId,l="companyId"in h&&h.companyId?h.companyId:j.companyId;if(!l)return{ok:!1,reason:"Invite is missing company id"};if(await (0,f.ensureWorkspaceUserAccess)({workspaceId:k,uid:d.uid,email:d.email||`${d.uid}@local.test`}),c.firestore){let e=(0,b.doc)(c.firestore,"workspaces",k,"companies",l,"members",d.uid);await (0,b.setDoc)(e,{id:d.uid,workspaceId:k,companyId:l,email:j.email.toLowerCase(),uid:d.uid,name:d.name||"",role:j.role,status:"active",invitedBy:j.createdBy,invitedAt:j.createdAt,joinedAt:new Date().toISOString(),inviteToken:a},{merge:!0}),await (0,b.updateDoc)((0,b.doc)(c.firestore,"invite_tokens",a),{status:"accepted",acceptedByUid:d.uid}),await (0,b.updateDoc)((0,b.doc)(c.firestore,"workspaces",k,"companies",l,"invites",a),{status:"accepted",acceptedByUid:d.uid})}else{await (0,e.activateMemberByEmail)(k,l,j.email,d.uid,d.name||"",j.role);let b=g.find(b=>b.token===a);b&&(b.status="accepted",b.acceptedByUid=d.uid,i(k,l))}return{ok:!0,workspaceId:k,companyId:l}}a.s(["acceptInviteByToken",()=>n,"buildInviteUrl",()=>k,"createCompanyInvite",()=>l,"subscribeCompanyInvites",()=>j])},75339,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(72131),e=a.i(50944),f=a.i(5151),g=a.i(92759),h=a.i(22168),i=a.i(93685),j=a.i(6977);function k({companyId:a}){let{appContext:c,setMembersByCompany:e}=(0,h.useAppState)(),[k,l]=(0,d.useState)([]),[m,n]=(0,d.useState)([]),[o,p]=(0,d.useState)(""),[q,r]=(0,d.useState)("client"),[s,t]=(0,d.useState)(null);async function u(){if(!o.trim())return void t("Email is required.");t(null);try{await (0,i.createCompanyInvite)(c.workspaceId,a,{email:o,role:q,createdBy:c.userId}),p(""),t("Invite created. Share the invite link below.")}catch(a){t(a instanceof Error?a.message:"Could not create invite")}}async function v(b,d){t(null);try{await (0,j.updateMemberRole)(c.workspaceId,a,b,d),t("Member role updated.")}catch(a){t(a instanceof Error?a.message:"Could not update member role")}}return(0,d.useEffect)(()=>(0,j.subscribeCompanyMembers)(c.workspaceId,a,b=>{l(b),e(c=>({...c,[a]:b}))},a=>t(a)),[c.workspaceId,a,e]),(0,d.useEffect)(()=>(0,i.subscribeCompanyInvites)(c.workspaceId,a,n,a=>t(a)),[c.workspaceId,a]),(0,b.jsxs)("section",{className:"panel",children:[(0,b.jsx)("h3",{children:"Company members"}),(0,b.jsxs)("div",{className:"form-grid two-col",children:[(0,b.jsxs)("label",{className:"two-col-span",children:[(0,b.jsx)("span",{children:"Client email"}),(0,b.jsx)("input",{value:o,onChange:a=>p(a.target.value),placeholder:"client@company.com"})]}),(0,b.jsxs)("label",{children:[(0,b.jsx)("span",{children:"Role"}),(0,b.jsxs)("select",{value:q,onChange:a=>r(a.target.value),children:[(0,b.jsx)("option",{value:"admin",children:"Admin"}),(0,b.jsx)("option",{value:"editor",children:"Editor"}),(0,b.jsx)("option",{value:"viewer",children:"Viewer"}),(0,b.jsx)("option",{value:"client",children:"Client"})]})]}),(0,b.jsxs)("label",{children:[(0,b.jsx)("span",{children:"Pending invites"}),(0,b.jsx)("input",{readOnly:!0,value:String(m.filter(a=>"pending"===a.status).length)})]})]}),(0,b.jsx)("div",{className:"button-row",children:(0,b.jsxs)("button",{type:"button",className:"btn-primary",onClick:u,children:[(0,b.jsx)(g.Send,{className:"h-4 w-4"})," Send invite"]})}),(0,b.jsx)("div",{className:"member-management-list",children:k.length?k.map(a=>(0,b.jsxs)("div",{className:"selector-member-row",children:[(0,b.jsx)("span",{children:a.name||a.email}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("select",{value:a.role,onChange:b=>v(a.id,b.target.value),className:"h-8 rounded-md border border-[var(--border)] bg-[var(--panel-soft)] px-2 text-xs",children:[(0,b.jsx)("option",{value:"admin",children:"Admin"}),(0,b.jsx)("option",{value:"editor",children:"Editor"}),(0,b.jsx)("option",{value:"viewer",children:"Viewer"}),(0,b.jsx)("option",{value:"client",children:"Client"})]}),(0,b.jsx)("span",{className:"badge",children:a.status})]})]},a.id)):(0,b.jsx)("p",{className:"text-sm text-[var(--muted)]",children:"No members yet for this company."})}),m.length?(0,b.jsx)("div",{className:"member-management-list",children:m.slice(0,8).map(a=>{let c=(0,i.buildInviteUrl)(a.token);return(0,b.jsxs)("div",{className:"selector-member-row",children:[(0,b.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:a.email}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"badge",children:[a.role," | ",a.status]}),(0,b.jsxs)("button",{type:"button",className:"btn-ghost",onClick:async()=>{try{await navigator.clipboard.writeText(c),t(`Invite link copied for ${a.email}.`)}catch{t("Could not copy invite link.")}},children:[(0,b.jsx)(f.Copy,{className:"h-4 w-4"})," Copy link"]})]})]},a.id)})}):null,s?(0,b.jsx)("p",{className:"text-sm text-[var(--muted)]",children:s}):null]})}var l=a.i(91123);function m(a){return JSON.stringify(a,null,2)}function n(a,b){try{return JSON.parse(a)}catch{return b}}function o({initialCompany:a}){let{appContext:c,setCompanies:e}=(0,h.useAppState)(),[f,g]=(0,d.useState)(a),[i,j]=(0,d.useState)(!1),[k,o]=(0,d.useState)(null),p=(0,d.useMemo)(()=>["identity","voice","visual","audience","content"],[]);async function q(){j(!0),o(null);try{let a=Math.min(100,Math.round(p.reduce((a,b)=>{let c=Object.values(f.sections[b]).some(a=>Array.isArray(a)?a.length>0:String(a||"").trim().length>0);return a+20*!!c},0)/100*100)),b={...f,completionScore:a,aiContextCompiled:`Brand: ${f.name} | Identity: ${f.sections.identity.tagline||"n/a"} | Voice: ${f.sections.voice.tone||"n/a"} | Visual: ${f.sections.visual.styleKeywords.join(", ")||"n/a"} | Audience: ${f.sections.audience.primaryPersona||"n/a"} | Content pillars: ${f.sections.content.pillars.join(", ")||"n/a"}`,updatedAt:new Date().toISOString(),updatedBy:c.userId};await (0,l.updateCompany)(c.workspaceId,f.id,b),g(b),e(a=>a.map(a=>a.id===b.id?b:a)),o("Saved profile changes.")}catch(a){o(a instanceof Error?a.message:"Save failed")}finally{j(!1)}}return(0,b.jsxs)("section",{className:"grid-two",children:[p.map(a=>(0,b.jsxs)("article",{className:"panel",children:[(0,b.jsx)("h3",{children:a.charAt(0).toUpperCase()+a.slice(1)}),(0,b.jsx)("p",{className:"text-sm text-[var(--muted)]",children:"Edit section JSON directly for now."}),(0,b.jsx)("textarea",{value:m(f.sections[a]),onChange:b=>{let c=n(b.target.value,f.sections[a]);g(b=>({...b,sections:{...b.sections,[a]:c}}))}})]},a)),(0,b.jsxs)("article",{className:"panel two-col-span",children:[(0,b.jsx)("h3",{children:"Prompt packs"}),(0,b.jsx)("textarea",{value:m(f.promptPacks),onChange:a=>{let b=n(a.target.value,f.promptPacks);g(a=>({...a,promptPacks:b}))}}),(0,b.jsx)("div",{className:"button-row",children:(0,b.jsx)("button",{className:"btn-primary",type:"button",onClick:q,disabled:i,children:i?"Saving...":"Save Company Profile"})}),k?(0,b.jsx)("p",{className:"text-sm text-[var(--muted)]",children:k}):null]})]})}var p=a.i(51538);function q(){let a=(0,e.useParams)(),{companies:f,setActiveCompany:g,markCompanyGateSeen:i}=(0,h.useAppState)(),j=f.find(b=>b.id===a.companyId)||null;return((0,d.useEffect)(()=>{j&&(g(j.id),i(!0))},[j,i,g]),j)?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(p.PageHeader,{title:j.name,subtitle:`Brand profile | ${j.completionScore}% complete`,actions:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(c.default,{className:"btn-ghost",href:`/companies/${j.id}/integrations`,children:"Manage Integrations"}),(0,b.jsx)(c.default,{className:"btn-primary",href:`/companies/${j.id}/intake`,children:"Open Intake Wizard"})]})}),(0,b.jsx)(k,{companyId:j.id}),(0,b.jsx)(o,{initialCompany:j})]}):(0,b.jsxs)("section",{className:"panel",children:[(0,b.jsx)("h3",{children:"Company not found"}),(0,b.jsx)("p",{children:"This company may have been removed or is not loaded in the current workspace."}),(0,b.jsxs)("div",{className:"button-row",children:[(0,b.jsx)(c.default,{className:"btn-primary",href:"/select-company",children:"Select company"}),(0,b.jsx)(c.default,{className:"btn-ghost",href:"/companies",children:"Back to companies"})]})]})}a.s(["default",()=>q],75339)}];

//# sourceMappingURL=_cfe0761e._.js.map